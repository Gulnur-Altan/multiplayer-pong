<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Multiplayer Pong</title>
    <style>
        canvas {
            background: black;
            display: block;
            margin: auto;
        }
    </style>
</head>

<body>
    <canvas id="game" width="600" height="400"></canvas>
    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        const canvas = document.getElementById("game");
        const ctx = canvas.getContext("2d");
        let players = {};
        let ball = { x: 0, y: 0 };

        document.addEventListener("mousemove", (e) => {
            const rect = canvas.getBoundingClientRect();
            const y = e.clientY - rect.top;
            socket.emit("move", y);
        });

        socket.on("state", (state) => {
            players = state.players;
            ball = state.ball;
            draw();
        });

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = "white";

            Object.values(players).forEach((p, i) => {
                ctx.fillRect(i === 0 ? 10 : 580, p.y, 10, 80);
            });

            ctx.beginPath();
            ctx.arc(ball.x, ball.y, 10, 0, Math.PI * 2);
            ctx.fill();
        }
    </script>
</body>

</html>